
> funnelhq-360@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

🔗 SupabaseStorage: Connected to production database
12:08:30 PM [express] serving on port 3000
🏢 Creating organization via backend API: { name: 'Test Backend Organization', userId: 'test_user_123' }
❌ Error creating organization: _ClerkAPIResponseError: Bad Request
    at OrganizationAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async createOrganizationBackend (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/create-organization-backend.ts:17:26) {
  toString: [Function (anonymous)],
  status: 400,
  clerkTraceId: '1f642da649bd38b63537ed655967e969',
  clerkError: true,
  errors: [
    {
      code: 'organization_creator_not_found',
      message: 'creator not found',
      longMessage: 'No users found with id test_user_123.',
      meta: [Object]
    }
  ]
}
12:08:53 PM [express] POST /api/create-organization 500 in 822ms :: {"error":"Failed to create organi…
12:09:19 PM [express] GET /api/notifications 304 in 17ms :: []
12:09:19 PM [express] GET /api/notifications/unread-count 304 in 4ms :: {"count":0}
12:10:19 PM [express] GET /api/notifications 304 in 6ms :: []
12:10:19 PM [express] GET /api/notifications/unread-count 304 in 2ms :: {"count":0}
12:11:19 PM [express] GET /api/notifications 304 in 7ms :: []
12:11:19 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:12:09 PM [express] GET /api/notifications 304 in 37ms :: []
12:12:09 PM [express] GET /api/notifications/unread-count 304 in 8ms :: {"count":0}
12:12:13 PM [express] GET /api/notifications 304 in 1ms :: []
12:12:13 PM [express] GET /api/notifications/unread-count 304 in 0ms :: {"count":0}
🔄 Fetching team members for organization: 1
🔄 SupabaseStorage.getTeamMembers: organizationId=1
12:12:13 PM [express] GET /api/team/invitations 304 in 0ms :: []
🔐 Auth middleware - Headers: {
  authorization: 'missing',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap'
}
❌ Auth middleware - Missing or invalid auth header
12:12:13 PM [express] GET /api/projects 401 in 1ms :: {"error":"Missing or invalid authorization head…
🔐 Auth middleware - Headers: {
  authorization: 'Bearer eyJhbGciOiJSU...',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap'
}
🎫 Auth middleware - Token length: 781
12:12:13 PM [express] GET /api/activities 304 in 0ms :: []
12:12:13 PM [express] GET /api/team/invitations 304 in 0ms :: []
12:12:13 PM [express] GET /api/supabase/users/crashdeals101%40gmail.com 200 in 634ms :: {"user":{"id"…
12:12:13 PM [express] GET /api/notifications 200 in 0ms :: []
12:12:13 PM [express] GET /api/notifications/unread-count 200 in 0ms :: {"count":0}
🔐 Auth middleware - Headers: {
  authorization: 'missing',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap'
}
❌ Auth middleware - Missing or invalid auth header
12:12:13 PM [express] GET /api/projects 401 in 1ms :: {"error":"Missing or invalid authorization head…
📋 User 42 (crashdeals101@gmail.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 34 (complete.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 33 (test@gmail.com): is_active=true, subscription_status=none, derived status = 'active'
📋 User 27 (debug.role@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 26 (test.editing@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 25 (brand.new.user@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 24 (freelancer@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 23 (unique.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 20 (restart.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 19 (vicy.7981@gmail.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 18 (david.wilson@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 17 (emma.davis@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 16 (alex.smith@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 15 (newuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 9 (testuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 8 (naveends798@gmail.com): is_active=true, subscription_status=active, derived status = 'active'
✅ Found 16 team members for organization 1
✅ Returning 16 team members: [
  '42:crashdeals101@gmail.com:active',
  '34:complete.test@example.com:active',
  '33:test@gmail.com:active',
  '27:debug.role@example.com:active',
  '26:test.editing@example.com:active',
  '25:brand.new.user@example.com:inactive',
  '24:freelancer@example.com:suspended',
  '23:unique.test@example.com:active',
  '20:restart.test@example.com:active',
  '19:vicy.7981@gmail.com:inactive',
  '18:david.wilson@example.com:active',
  '17:emma.davis@example.com:suspended',
  '16:alex.smith@example.com:active',
  '15:newuser@example.com:inactive',
  '9:testuser@example.com:inactive',
  '8:naveends798@gmail.com:active'
]
12:12:13 PM [express] GET /api/team/members 200 in 811ms :: [{"id":42,"supabase_id":null,"username":n…
🔄 Fetching team members for organization: 1
🔄 SupabaseStorage.getTeamMembers: organizationId=1
Transformed clients for organization undefined: [
  {
    id: 21,
    name: 'test ',
    organizationId: 1,
    joinedAt: '2025-06-26T08:42:51.02+00:00'
  },
  {
    id: 20,
    name: 'Test clinet 1',
    organizationId: 1,
    joinedAt: '2025-06-26T04:39:14.611+00:00'
  },
  {
    id: 13,
    name: 'FIXED CLIENT TEST',
    organizationId: 1,
    joinedAt: '2025-06-25T11:38:37.413+00:00'
  }
]
12:12:14 PM [express] GET /api/stats 304 in 850ms :: {"activeProjects":1,"totalClients":3,"monthlyRev…
❌ Authentication error: _ClerkAPIResponseError: Gone
    at SessionAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async authenticateUser (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/auth-middleware.ts:43:21) {
  toString: [Function (anonymous)],
  status: 410,
  clerkTraceId: '6ab3769b52ac6121c6673477fd80c72a',
  clerkError: true,
  errors: [
    {
      code: 'operation_deprecated',
      message: 'endpoint is deprecated and pending removal',
      longMessage: 'This endpoint is deprecated and will be removed in future versions. We strongly recommend switching to networkless verification using short-lived session tokens, which is implemented transparently in all recent SDK versions (e.g. NodeJS SDK https://clerk.com/docs/backend-requests/handling/nodejs#clerk-express-require-auth). For more details on how networkless verification works, refer to our Session Tokens documentation https://clerk.com/docs/backend-requests/resources/session-tokens.',
      meta: [Object]
    }
  ]
}
Auth error details: {
  message: 'Gone',
  name: 'Error',
  stack: 'Error: Gone\n' +
    '    at SessionAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async authenticateUser (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/auth-middleware.ts:43:21)'
}
12:12:14 PM [express] GET /api/clients 401 in 928ms :: {"error":"Authentication failed","details":"Go…
📋 User 42 (crashdeals101@gmail.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 34 (complete.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 33 (test@gmail.com): is_active=true, subscription_status=none, derived status = 'active'
📋 User 27 (debug.role@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 26 (test.editing@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 25 (brand.new.user@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 24 (freelancer@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 23 (unique.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 20 (restart.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 19 (vicy.7981@gmail.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 18 (david.wilson@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 17 (emma.davis@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 16 (alex.smith@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 15 (newuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 9 (testuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 8 (naveends798@gmail.com): is_active=true, subscription_status=active, derived status = 'active'
✅ Found 16 team members for organization 1
✅ Returning 16 team members: [
  '42:crashdeals101@gmail.com:active',
  '34:complete.test@example.com:active',
  '33:test@gmail.com:active',
  '27:debug.role@example.com:active',
  '26:test.editing@example.com:active',
  '25:brand.new.user@example.com:inactive',
  '24:freelancer@example.com:suspended',
  '23:unique.test@example.com:active',
  '20:restart.test@example.com:active',
  '19:vicy.7981@gmail.com:inactive',
  '18:david.wilson@example.com:active',
  '17:emma.davis@example.com:suspended',
  '16:alex.smith@example.com:active',
  '15:newuser@example.com:inactive',
  '9:testuser@example.com:inactive',
  '8:naveends798@gmail.com:active'
]
12:12:14 PM [express] GET /api/team/members 304 in 159ms :: [{"id":42,"supabase_id":null,"username":n…
12:13:18 PM [express] GET /api/supabase/users/crashdeals101%40gmail.com 404 in 211ms :: {"error":"Use…
12:13:20 PM [express] GET /api/notifications 304 in 1ms :: []
12:13:20 PM [express] GET /api/notifications/unread-count 304 in 0ms :: {"count":0}
🔐 Auth middleware - Headers: {
  authorization: 'Bearer eyJhbGciOiJSU...',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap'
}
🎫 Auth middleware - Token length: 780
🔄 Fetching team members for organization: 1
🔄 SupabaseStorage.getTeamMembers: organizationId=1
12:13:20 PM [express] GET /api/team/invitations 304 in 0ms :: []
12:13:20 PM [express] GET /api/team/invitations 304 in 0ms :: []
🔐 Auth middleware - Headers: {
  authorization: 'missing',
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap'
}
❌ Auth middleware - Missing or invalid auth header
12:13:20 PM [express] GET /api/projects 401 in 0ms :: {"error":"Missing or invalid authorization head…
12:13:20 PM [express] GET /api/activities 304 in 1ms :: []
Transformed clients for organization undefined: [
  {
    id: 21,
    name: 'test ',
    organizationId: 1,
    joinedAt: '2025-06-26T08:42:51.02+00:00'
  },
  {
    id: 20,
    name: 'Test clinet 1',
    organizationId: 1,
    joinedAt: '2025-06-26T04:39:14.611+00:00'
  },
  {
    id: 13,
    name: 'FIXED CLIENT TEST',
    organizationId: 1,
    joinedAt: '2025-06-25T11:38:37.413+00:00'
  }
]
12:13:20 PM [express] GET /api/stats 304 in 148ms :: {"activeProjects":1,"totalClients":3,"monthlyRev…
📋 User 34 (complete.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 33 (test@gmail.com): is_active=true, subscription_status=none, derived status = 'active'
📋 User 27 (debug.role@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 26 (test.editing@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 25 (brand.new.user@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 24 (freelancer@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 23 (unique.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 20 (restart.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 19 (vicy.7981@gmail.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 18 (david.wilson@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 17 (emma.davis@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 16 (alex.smith@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 15 (newuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 9 (testuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 8 (naveends798@gmail.com): is_active=true, subscription_status=active, derived status = 'active'
✅ Found 15 team members for organization 1
✅ Returning 15 team members: [
  '34:complete.test@example.com:active',
  '33:test@gmail.com:active',
  '27:debug.role@example.com:active',
  '26:test.editing@example.com:active',
  '25:brand.new.user@example.com:inactive',
  '24:freelancer@example.com:suspended',
  '23:unique.test@example.com:active',
  '20:restart.test@example.com:active',
  '19:vicy.7981@gmail.com:inactive',
  '18:david.wilson@example.com:active',
  '17:emma.davis@example.com:suspended',
  '16:alex.smith@example.com:active',
  '15:newuser@example.com:inactive',
  '9:testuser@example.com:inactive',
  '8:naveends798@gmail.com:active'
]
12:13:20 PM [express] GET /api/team/members 200 in 202ms :: [{"id":34,"supabase_id":null,"username":"…
🔄 Fetching team members for organization: 1
🔄 SupabaseStorage.getTeamMembers: organizationId=1
📋 User 34 (complete.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 33 (test@gmail.com): is_active=true, subscription_status=none, derived status = 'active'
📋 User 27 (debug.role@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 26 (test.editing@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 25 (brand.new.user@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 24 (freelancer@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 23 (unique.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 20 (restart.test@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 19 (vicy.7981@gmail.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 18 (david.wilson@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 17 (emma.davis@example.com): is_active=false, subscription_status=suspended, derived status = 'suspended'
📋 User 16 (alex.smith@example.com): is_active=true, subscription_status=active, derived status = 'active'
📋 User 15 (newuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 9 (testuser@example.com): is_active=false, subscription_status=active, derived status = 'inactive'
📋 User 8 (naveends798@gmail.com): is_active=true, subscription_status=active, derived status = 'active'
✅ Found 15 team members for organization 1
✅ Returning 15 team members: [
  '34:complete.test@example.com:active',
  '33:test@gmail.com:active',
  '27:debug.role@example.com:active',
  '26:test.editing@example.com:active',
  '25:brand.new.user@example.com:inactive',
  '24:freelancer@example.com:suspended',
  '23:unique.test@example.com:active',
  '20:restart.test@example.com:active',
  '19:vicy.7981@gmail.com:inactive',
  '18:david.wilson@example.com:active',
  '17:emma.davis@example.com:suspended',
  '16:alex.smith@example.com:active',
  '15:newuser@example.com:inactive',
  '9:testuser@example.com:inactive',
  '8:naveends798@gmail.com:active'
]
12:13:20 PM [express] GET /api/team/members 304 in 86ms :: [{"id":34,"supabase_id":null,"username":"c…
❌ Authentication error: _ClerkAPIResponseError: Gone
    at SessionAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async authenticateUser (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/auth-middleware.ts:43:21) {
  toString: [Function (anonymous)],
  status: 410,
  clerkTraceId: '88a1d1dd2db9cd64a264440f4d166b7b',
  clerkError: true,
  errors: [
    {
      code: 'operation_deprecated',
      message: 'endpoint is deprecated and pending removal',
      longMessage: 'This endpoint is deprecated and will be removed in future versions. We strongly recommend switching to networkless verification using short-lived session tokens, which is implemented transparently in all recent SDK versions (e.g. NodeJS SDK https://clerk.com/docs/backend-requests/handling/nodejs#clerk-express-require-auth). For more details on how networkless verification works, refer to our Session Tokens documentation https://clerk.com/docs/backend-requests/resources/session-tokens.',
      meta: [Object]
    }
  ]
}
Auth error details: {
  message: 'Gone',
  name: 'Error',
  stack: 'Error: Gone\n' +
    '    at SessionAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async authenticateUser (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/auth-middleware.ts:43:21)'
}
12:13:20 PM [express] GET /api/clients 401 in 796ms :: {"error":"Authentication failed","details":"Go…
12:13:50 PM [express] GET /api/notifications 304 in 1ms :: []
12:13:50 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:14:20 PM [express] GET /api/notifications 304 in 5ms :: []
12:14:20 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:14:54 PM [express] GET /api/notifications 304 in 2ms :: []
12:14:54 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:15:20 PM [express] GET /api/notifications 304 in 4ms :: []
12:15:20 PM [express] GET /api/notifications/unread-count 304 in 0ms :: {"count":0}
12:15:51 PM [express] GET /api/notifications 304 in 1ms :: []
12:15:51 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:16:20 PM [express] GET /api/notifications 304 in 5ms :: []
12:16:20 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:17:19 PM [express] GET /api/notifications 304 in 16ms :: []
12:17:19 PM [express] GET /api/notifications/unread-count 304 in 7ms :: {"count":0}
12:18:19 PM [express] GET /api/notifications 304 in 6ms :: []
12:18:19 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
🏢 Creating organization via backend API: {
  name: 'Test Organization API',
  userId: 'user_2z52Qbf8nhCuOcljaNc696UzieK'
}
✅ Organization created successfully: org_2z5337Uj32eo2tsA3XnzHWKVlbj
❌ Error creating organization: _ClerkAPIResponseError: Bad Request
    at OrganizationAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async createOrganizationBackend (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/create-organization-backend.ts:32:5) {
  toString: [Function (anonymous)],
  status: 400,
  clerkTraceId: '1c35ec77b58edd2f24862bdf245a63de',
  clerkError: true,
  errors: [
    {
      code: 'already_a_member_in_organization',
      message: 'already a member',
      longMessage: 'User is already a member of the organization.',
      meta: [Object]
    }
  ]
}
12:18:24 PM [express] POST /api/create-organization 500 in 883ms :: {"error":"Failed to create organi…
12:19:19 PM [express] GET /api/notifications 304 in 9ms :: []
12:19:19 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
12:20:19 PM [express] GET /api/notifications 304 in 2ms :: []
12:20:19 PM [express] GET /api/notifications/unread-count 304 in 2ms :: {"count":0}
🏢 Creating organization via backend API: {
  name: 'Fixed Organization API',
  userId: 'user_2z52Qbf8nhCuOcljaNc696UzieK'
}
✅ Organization created successfully: org_2z53IEipg6bC1rLsc2XdkdpggjX
❌ Error creating organization: _ClerkAPIResponseError: Bad Request
    at OrganizationAPI.request (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/node_modules/@clerk/backend/src/api/request.ts:63:21)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async createOrganizationBackend (/Users/home/Desktop/FunnelHQ 360 upDATES/FunnelHQ-360-V2-main/server/api/create-organization-backend.ts:32:5) {
  toString: [Function (anonymous)],
  status: 400,
  clerkTraceId: 'dc8d168d3e0a80df63d74a8f4c2b7574',
  clerkError: true,
  errors: [
    {
      code: 'already_a_member_in_organization',
      message: 'already a member',
      longMessage: 'User is already a member of the organization.',
      meta: [Object]
    }
  ]
}
12:20:24 PM [express] POST /api/create-organization 500 in 1171ms :: {"error":"Failed to create organ…
12:21:19 PM [express] GET /api/notifications 304 in 8ms :: []
12:21:19 PM [express] GET /api/notifications/unread-count 304 in 2ms :: {"count":0}
12:22:19 PM [express] GET /api/notifications 304 in 3ms :: []
12:22:19 PM [express] GET /api/notifications/unread-count 304 in 1ms :: {"count":0}
